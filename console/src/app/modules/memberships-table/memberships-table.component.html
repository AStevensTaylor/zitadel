<cnsl-refresh-table *ngIf="dataSource" (refreshed)="changePage()" [dataSize]="dataSource.totalResult"
  [timestamp]="dataSource.viewTimestamp" [selection]="selection" [loading]="dataSource?.loading$ | async">

  <ng-container actions *ngIf="selection.hasValue()">
    <ng-content select="[selectactions]"></ng-content>
  </ng-container>

  <div actions>
    <ng-content select="[writeactions]"></ng-content>
  </div>

  <div class="table-wrapper">
    <table mat-table class="table" aria-label="Elements" [dataSource]="dataSource">
      <ng-container matColumnDef="select">
        <th class="selection" mat-header-cell *matHeaderCellDef>
          <mat-checkbox [disabled]="false" color="primary" (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td class="selection" mat-cell *matCellDef="let row">
          <mat-checkbox [disabled]="false" color="primary" (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)">

          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="displayName">
        <th mat-header-cell *matHeaderCellDef> {{ 'USER.MEMBERSHIPS.DISPLAYNAME' | translate }} </th>
        <td class="pointer" [routerLink]="['/users', membership.userId]" mat-cell *matCellDef="let membership">
          {{membership.displayName}} </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> {{ 'USER.MEMBERSHIPS.TYPE' | translate }} </th>
        <td class="pointer" mat-cell *matCellDef="let membership">
          <span class="state">{{getType(membership)}}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="orgId">
        <th mat-header-cell *matHeaderCellDef> {{ 'USER.MEMBERSHIPS.ORGID' | translate }} </th>
        <td class="pointer" mat-cell *matCellDef="let membership">
          {{membership.orgId}} </td>
      </ng-container>

      <!-- <ng-container matColumnDef="loginname">
        <th mat-header-cell *matHeaderCellDef> {{ 'PROJECT.MEMBER.LOGINNAME' | translate }} </th>
        <td class="pointer" [routerLink]="['/users', member.userId]" mat-cell *matCellDef="let member">
          {{member.preferredloginname}} </td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> {{ 'PROJECT.MEMBER.EMAIL' | translate }} </th>
        <td class="pointer" [routerLink]="['/users', member.userId]" mat-cell *matCellDef="let member">
          {{member.email}}
        </td>
      </ng-container> -->

      <ng-container matColumnDef="rolesList">
        <th mat-header-cell *matHeaderCellDef class="role-row"> {{ 'ROLESLABEL' | translate }} </th>
        <td mat-cell *matCellDef="let membership" class="flex-role-row">
          <cnsl-form-field *ngIf="membership" class="form-field" appearance="outline">
            <mat-select [(ngModel)]="membership.rolesList" multiple (openedChange)="loadRoles(membership, $event)"
              [disabled]="false" (selectionChange)="updateRoles(membership, $event)">
              <mat-option
                *ngFor="let role of ((isCurrentMembership(membership) && membershipRoleOptions.length) ? membershipRoleOptions : membership.rolesList)"
                [value]="role">
                {{ role }}
              </mat-option>
            </mat-select>
          </cnsl-form-field>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr class="highlight" mat-row *matRowDef="let row; columns: displayedColumns;">
      </tr>
    </table>
  </div>
  <cnsl-paginator *ngIf="dataSource" class="paginator" #paginator [timestamp]="dataSource?.viewTimestamp"
    [pageSize]="INITIALPAGESIZE" [length]="dataSource.totalResult" [pageSizeOptions]="[25, 50, 100, 250]"
    (page)="changePage($event)">
  </cnsl-paginator>
</cnsl-refresh-table>