<mat-toolbar class="header-wrapper">
  <div class="header-content">
    <ng-container *ngIf="labelpolicy && !labelpolicy?.disableWatermark">
      <a class="title" [routerLink]="['/']">
        <img class="logo" alt="zitadel logo" *ngIf="isDarkTheme; else lighttheme"
          src="../assets/images/zitadel-logo-solo-light.svg" />
        <ng-template #lighttheme>
          <img alt="zitadel logo" class="logo" src="../assets/images/zitadel-logo-solo-dark.svg" />
        </ng-template>
      </a>

      <svg class="slash" viewBox="0 0 24 24" width="32" height="32" stroke="currentColor" stroke-width="1"
        stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision">
        <path d="M16.88 3.549L7.12 20.451"></path>
      </svg>
    </ng-container>

    <div class="org-context" *ngIf="user && org">
      <a matRipple [matRippleUnbounded]="false" class="org-link" [routerLink]="[ '/org']">
        {{org?.name ? org.name : 'NO NAME'}}</a>
      <button matRipple [matRippleUnbounded]="false" class="org-switch-button" (click)="loadOrgs()"
        [matMenuTriggerFor]="menu" (menuOpened)="focusFilter()">
        <span class="svgsapn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd"
              d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg></span>
      </button>
    </div>

    <mat-menu class="menu" #menu="matMenu">
      <div class="spinner-w">
        <mat-spinner diameter="20" *ngIf="orgLoading$ | async" color="accent">
        </mat-spinner>
      </div>

      <div class="filter-wrapper">
        <input cnslInput class="filter-input" [formControl]="filterControl" autocomplete="off"
          (click)="$event.stopPropagation()" placeholder="{{'ORG.PAGES.FILTERPLACEHOLDER' | translate}}" #input>
      </div>

      <div class="org-wrapper">
        <button [ngClass]="{'active': temporg.id === org?.id}" [disabled]="!temporg.id"
          *ngFor="let temporg of orgs$ | async" mat-menu-item (click)="setActiveOrg(temporg)">
          {{temporg?.name ? temporg.name : 'NO NAME'}}
        </button>
      </div>

      <button class="show-all" mat-menu-item [routerLink]="[ '/org/overview' ]">{{'MENU.SHOWORGS' |
        translate}}</button>

      <ng-template cnslHasRole [cnslHasRole]="['org.create','iam.write']">
        <button mat-menu-item [routerLink]="[ '/org/create' ]">
          <mat-icon class="avatar">add</mat-icon>
          {{'MENU.NEWORG'Â | translate}}
        </button>
      </ng-template>
    </mat-menu>
    <span class="fill-space"></span>

    <a class="doc-link" href="https://docs.zitadel.ch" mat-stroked-button target="_blank">
      {{'MENU.DOCUMENTATION' | translate}}
    </a>

    <a *ngIf="(['iam.read$','iam.write$'] | hasRole | async)" [routerLink]="[ '/iam','policies']" class="iam-settings"
      mat-icon-button>
      <i class="las la-cog"></i>
    </a>

    <div cnslOutsideClick (clickOutside)="closeAccountCard()" class="icon-container">
      <cnsl-avatar
        *ngIf="user && (user.human?.profile?.displayName || (user.human?.profile?.firstName && user.human?.profile?.lastName))"
        class="avatar-toggle dontcloseonclick" (click)="showAccount = !showAccount" [active]="showAccount"
        [avatarUrl]="user.human?.profile?.avatarUrl || ''" [forColor]="user?.preferredLoginName || ''"
        [name]="user.human?.profile?.displayName ? user.human?.profile?.displayName ?? '' : (user.human?.profile?.firstName + ' '+ user.human?.profile?.lastName) ?? ''"
        [size]="38">
      </cnsl-avatar>
      <cnsl-accounts-card @accounts class="a_card" *ngIf="showAccount" (close)="showAccount = false" [user]="user"
        [iamuser]="(['iam.read$','iam.write$'] | hasRole) | async">
      </cnsl-accounts-card>
    </div>
  </div>
</mat-toolbar>