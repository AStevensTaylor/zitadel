<div class="granted-project-top">
  <div class="max-width-container">
    <div class="granted-project-top-row">
      <div>
        <div class="granted-project-link-row">
          <a class="link" [routerLink]="[ '/projects' ]" [queryParams]="{'type':'granted'}" mat-icon-button>
            <mat-icon class="icon">arrow_back</mat-icon>
          </a>
          <div>
            <div class="granted-project-title-row">
              <h2 class="granted-project-title">{{project?.projectName}}</h2>
              <div class="granted-project-state-dot" *ngIf="project && project.state !== undefined"
                matTooltip="{{'ORG.STATE.'+project.state | translate}}"
                [ngClass]="{'active': project.state === ProjectGrantState.PROJECT_GRANT_STATE_ACTIVE, 'inactive': project.state === ProjectGrantState.PROJECT_GRANT_STATE_INACTIVE }">
              </div>
            </div>
            <div class="doc-row">
              <span class="project-type">{{'PROJECT.PAGES.TYPE.GRANTED_SINGULAR' | translate}} {{'ACTIONS.OF' |
                translate}}
                <strong>{{project?.projectOwnerName}}</strong></span>
              <a mat-icon-button href="https://docs.zitadel.ch/docs/guides/basics/projects#what-is-a-granted-project"
                rel="noreferrer" target="_blank">
                <i class="las la-info-circle"></i>
              </a>
            </div>
          </div>
        </div>
        <p *ngIf="isZitadel" class="granted-project-sub zitadel-warning">{{'PROJECT.PAGES.ZITADELPROJECT' | translate}}
        </p>
      </div>
      <span class="fill-space"></span>
      <cnsl-contributors class="project-contributors" *ngIf="project" [loading]="loading$ | async"
        [totalResult]="totalMemberResult" [membersSubject]="membersSubject"
        title="{{ 'PROJECT.MEMBER.TITLE' | translate }}" description="{{ 'PROJECT.MEMBER.TITLEDESC' | translate }}"
        (addClicked)="openAddMember()" (showDetailClicked)="showDetail()" (refreshClicked)="loadMembers()"
        [disabled]="(['project.member.write$', 'project.member.write:'+ project.projectId]| hasRole | async) === false">
      </cnsl-contributors>
    </div>
    <cnsl-info-row *ngIf="project" [grantedProject]="project"></cnsl-info-row>
  </div>
</div>

<div class="max-width-container">
  <cnsl-meta-layout>
    <ng-template cnslHasRole [hasRole]="['user.grant.read', 'user.grant.read:'+grantId]">
      <cnsl-card *ngIf="project?.projectId" title="{{ 'GRANTS.PROJECT.TITLE' | translate }}"
        description="{{'GRANTS.PROJECT.DESCRIPTION' | translate }}">
        <cnsl-user-grants *ngIf="projectId && grantId" [context]="UserGrantContext.GRANTED_PROJECT"
          [projectId]="projectId" [grantId]="grantId"
          [displayedColumns]="['select','user', 'projectId', 'dates', 'roleNamesList']"
          [disableWrite]="(['user.grant.write$','user.grant.write:'+grantId] | hasRole | async) === false"
          [disableDelete]="(['user.grant.delete$','user.grant.delete:'+grantId] | hasRole | async) === false"
          [refreshOnPreviousRoutes]="['/grant-create/project/{{projectId}}/grant/{{grantId}}']">
        </cnsl-user-grants>
      </cnsl-card>
    </ng-template>

    <div metainfo>
      <cnsl-changes *ngIf="project" [changeType]="ChangeType.PROJECT" [id]="project.projectId"></cnsl-changes>
    </div>

  </cnsl-meta-layout>
</div>